import{u as B}from"./use-quasar.015d7623.js";import{m as M,ab as Q,ah as A,r as F,ac as z,o as d,b as R,w as H,d as t,h as k,am as j,ai as s,az as D,e as c,t as u,k as h,aE as U,an as O,al as C,H as L,ad as G,ae as J}from"./index.da47becb.js";import{Q as K}from"./QSelect.f6cc18b0.js";import{c as P,a as w}from"./index.esm.5bb29c97.js";import{u as W,a as x}from"./vee-validate.esm.0261b950.js";import"./QItemLabel.a4a1797c.js";import"./rtl.b51694b1.js";const X={class:"flex flex-col gap-5"},Y={key:0,class:"error"},Z={key:0,class:"error"},ee={key:0,class:"error"},te=M({__name:"add-entity-dialog",props:["show","editingEntity","editingEntityIndex"],emits:["closeDialog","reload"],setup(V,{emit:p}){var q,$,I,T,N,S;const n=V;B();const _=Q(),e=A(),g=F({schema:P({name:w().nullable("Database name is required!").required("Database name is required!"),collection:w().nullable("Database collection is required!").required("Database collection is required!"),classType:w().nullable("Class type is required!").required("Class type is required!")}),types:["string","number","boolean"]}),{handleSubmit:b,errors:o}=W({validationSchema:g.schema,initialValues:{name:($=(q=n.editingEntity)==null?void 0:q.name)!=null?$:void 0,collection:(T=(I=n.editingEntity)==null?void 0:I.collectionName)!=null?T:void 0,classType:(S=(N=n.editingEntity)==null?void 0:N.type)!=null?S:void 0}}),{value:l}=x("name"),{value:r}=x("collection"),{value:i}=x("classType");for(let y of e.project.modules)for(let a of y.models)g.types.push(y.name+"."+a.name);function m(){p("closeDialog")}async function E(){b(async()=>{const y=new U.MongoCollection({name:l.value,type:i.value,collectionName:r.value}),a=e.project.mongoDatabses.find(v=>v.name==_.params.name);a?(n.editingEntity?a.schemas[n.editingEntityIndex]=y:a.schemas.push(y),await O.save(e.project),C.success(`Entity was ${n.editingEntity?"edited":"added"} successfully.`),m()):C.success("Entity was not found!")})()}return(y,a)=>{const v=z("Dialog");return d(),R(v,{show:n.show,title:n.editingEntity?"Edit Entity":"Add Entity",onCloseDialog:m,onConfirmDialog:E},{default:H(()=>[t("div",X,[t("div",null,[k(j,{outlined:"",error:!!s(o).name,modelValue:s(l),"onUpdate:modelValue":a[0]||(a[0]=f=>D(l)?l.value=f:null),"hide-bottom-space":"",dark:s(e).isDark,label:"Entity name",type:"text",class:"mt-2"},null,8,["error","modelValue","dark"]),s(o).name?(d(),c("span",Y,u(s(o).name),1)):h("",!0)]),t("div",null,[k(j,{outlined:"",error:!!s(o).collection,modelValue:s(r),"onUpdate:modelValue":a[1]||(a[1]=f=>D(r)?r.value=f:null),"hide-bottom-space":"",dark:s(e).isDark,label:"Entity collection",type:"text",class:"mt-2"},null,8,["error","modelValue","dark"]),s(o).collection?(d(),c("span",Z,u(s(o).collection),1)):h("",!0)]),t("div",null,[k(K,{outlined:"",error:!!s(o).classType,dark:s(e).isDark,modelValue:s(i),"onUpdate:modelValue":a[2]||(a[2]=f=>D(i)?i.value=f:null),options:g.types,label:"Class Type","hide-bottom-space":""},null,8,["error","dark","modelValue","options"]),s(o).classType?(d(),c("span",ee,u(s(o).classType),1)):h("",!0)])])]),_:1},8,["show","title"])}}}),se={class:"card"},ae={class:"card-header"},ne={class:"title"},oe={key:0,class:"card-body"},le={class:"table"},ie=t("thead",null,[t("tr",{class:"tr-header"},[t("th",{class:"text-left"},"Name"),t("th",{class:"text-left"},"Collection Name"),t("th",{class:"text-left"},"Type"),t("th",{class:"text-right"},"Setting")])],-1),re={class:"font-bold"},de={class:"flex items-center justify-end gap-2"},ce=["onClick"],ue=t("i",{class:"text-md fas fa-pen"},null,-1),me=[ue],ye=["onClick"],pe=t("i",{class:"text-md fas fa-trash-alt"},null,-1),ge=[pe],De=M({__name:"mongo-db-item",setup(V){const p=A(),n=Q(),_=B(),e=F({showEntityDialog:!1,loading:!0,database:new U.MongoDatabase,editingEntity:null,editingEntityIndex:-1});L(()=>{e.loading=!0,e.database=p.project.mongoDatabses.find(l=>l.name==n.params.name),e.loading=!1});function g(l){_.dialog({title:"Remove Entity",message:"Are you sure you would like to remove this entity?",dark:p.isDark,cancel:!0}).onOk(async()=>{e.database.schemas.splice(l,1),await O.save(p.project),C.success("Entity was removed successfully!")})}function b(l,r){e.editingEntity=l,e.editingEntityIndex=r,e.showEntityDialog=!0}function o(){e.showEntityDialog=!1,e.editingEntityIndex=-1,e.editingEntity=null}return(l,r)=>(d(),c("div",se,[t("div",ae,[t("span",ne,"Mongo Database : "+u(s(n).params.name),1),t("button",{class:"btn btn-green",onClick:r[0]||(r[0]=i=>e.showEntityDialog=!0)}," Add Entity ")]),e.loading?h("",!0):(d(),c("div",oe,[t("table",le,[ie,t("tbody",null,[(d(!0),c(G,null,J(e.database.schemas,(i,m)=>(d(),c("tr",{class:"tr-body",key:m},[t("td",re,u(i.name),1),t("td",null,u(i.collectionName),1),t("td",null,u(i.type),1),t("td",de,[t("button",{class:"btn-squar btn-yellow",onClick:E=>b(i,m)},me,8,ce),t("button",{class:"btn-squar btn-red",onClick:E=>g(m)},ge,8,ye)])]))),128))])])])),e.showEntityDialog?(d(),R(te,{key:1,show:e.showEntityDialog,editingEntity:e.editingEntity,editingEntityIndex:e.editingEntityIndex,onCloseDialog:o},null,8,["show","editingEntity","editingEntityIndex"])):h("",!0)]))}});export{De as default};
